[debug] [2025-07-21T18:12:50.196Z] ----------------------------------------------------------------------
[debug] [2025-07-21T18:12:50.205Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-21T18:12:50.211Z] CLI Version:   14.10.1
[debug] [2025-07-21T18:12:50.214Z] Platform:      linux
[debug] [2025-07-21T18:12:50.215Z] Node Version:  v20.19.1
[debug] [2025-07-21T18:12:50.218Z] Time:          Mon Jul 21 2025 18:12:50 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-21T18:12:50.218Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-21T18:12:52.103Z] openjdk version "21.0.7" 2025-04-15

[debug] [2025-07-21T18:12:52.115Z] OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-21T18:12:52.152Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-21T18:12:52.193Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-21T18:12:52.211Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-21T18:12:52.275Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-21T18:12:52.276Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-21T18:12:52.279Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-21T18:12:58.309Z] Jul 21, 2025 6:12:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:12:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-21T18:12:58.395Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-21T18:12:58.400Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-21T18:12:58.514Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-07-21T18:25:29.785Z] ----------------------------------------------------------------------
[debug] [2025-07-21T18:25:29.795Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-21T18:25:29.796Z] CLI Version:   14.10.1
[debug] [2025-07-21T18:25:29.796Z] Platform:      linux
[debug] [2025-07-21T18:25:29.796Z] Node Version:  v20.19.1
[debug] [2025-07-21T18:25:29.797Z] Time:          Mon Jul 21 2025 18:25:29 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-21T18:25:29.798Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-21T18:25:32.009Z] openjdk version "21.0.7" 2025-04-15
OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-21T18:25:32.077Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-21T18:25:32.118Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-21T18:25:32.139Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-21T18:25:32.197Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-21T18:25:32.198Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-21T18:25:32.201Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-21T18:25:38.876Z] Jul 21, 2025 6:25:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:25:38 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-21T18:25:38.952Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-21T18:25:38.953Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-21T18:25:39.076Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:33:51.218Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:33:51.218Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isAdmin() {\n      // This function relies on a custom claim set on the user's auth token.\n      // This is the most secure method but requires server-side setup to assign the claim.\n      return request.auth.token.admin == true;\n    }\n\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n\n    match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n    \n    match /appointments/{appointmentId} {\n      // Any authenticated user can create an appointment for themselves.\n      // The `userId` field in the new document must match their own UID.\n      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;\n\n      // WARNING: THIS IS A TEMPORARY RULE FOR DEBUGGING\n      // It allows ANY logged-in user to read all appointments.\n      // This is NOT secure for production.\n      allow read: if request.auth != null;\n      \n      // Update/delete should still be admin-only.\n      allow update, delete: if isAdmin();\n    }\n\n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n    \n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:33:51.248Z] Jul 21, 2025 6:33:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:33:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:33:51.891Z] Jul 21, 2025 6:33:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:33:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:33:55.438Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:33:55.438Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:35:33.468Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:35:33.468Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":""}]}}
[debug] [2025-07-21T18:35:33.490Z] Jul 21, 2025 6:35:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:35:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:35:33.614Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:35:33.614Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isAdmin() {\n      // NOTE: This is the secure, production-ready way to check for an admin.\n      // This will work once the custom claim is set on your user account.\n      return request.auth.token.admin == true;\n    }\n\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n\n    match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n\n    // Rules for the 'appointments' collection.\n    match /appointments/{apptId} {\n      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;\n      \n      // TEMPORARY DEBUGGING RULE: Allow any authenticated user to read/write.\n      // WARNING: Insecure for production.\n      allow read, update, delete: if request.auth != null;\n    }\n\n    // Rules for the 'settings' collection.\n    match /settings/{docId} {\n      // TEMPORARY DEBUGGING RULE: Allow any authenticated user to read/write.\n      // WARNING: Insecure for production.\n      allow read, write: if request.auth != null;\n    }\n\n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:35:33.635Z] Jul 21, 2025 6:35:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:35:33 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:35:33.861Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:35:33.868Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules"},"description":"Rules content empty. Compilation aborted.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:0:0 - ERROR Rules content empty. Compilation aborted. 
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-21T18:35:33.878Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:35:33.878Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:38:00.130Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:38:00.130Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // This function checks the user's authentication token for an 'admin' custom claim.\n    // This is the most secure way to identify an admin. You must set this claim\n    // on a user's account using a server-side process (like a Firebase Function).\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // A user can read/write their own user document and its subcollections.\n    // An admin can also read/write any user's document and subcollections.\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    // A user can create an application for themselves.\n    // An admin can read or update any application.\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    // Appointments can be created by any authenticated user for themselves.\n    // Admins can read/update/delete any appointment.\n    // Users can read only their own appointments.\n    match /appointments/{appointmentId} {\n     allow create: if request.auth.uid != null && request.resource.data.userId == request.auth.uid;\n     allow read: if request.auth.uid == resource.data.userId || isAdmin();\n     allow update, delete: if isAdmin();\n    }\n\n    // Admins have full control over settings, news, and mail collections.\n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n    match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n  }\n}\n    "}]}}
[debug] [2025-07-21T18:38:00.155Z] Jul 21, 2025 6:38:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:38:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:38:00.292Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:38:00.292Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:39:53.890Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:39:53.895Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isAdmin() {\n      // This is the correct, secure way to check for an admin role\n      // based on a custom claim set on the user's authentication token.\n      return request.auth.token.admin == true;\n    }\n\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    match /appointments/{appointmentId} {\n      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n\n    match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n    \n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n    \n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:39:53.922Z] Jul 21, 2025 6:39:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:39:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:39:54.147Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:39:54.150Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:41:37.325Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:41:37.325Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper for your admin custom claim\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // Rules for user data\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    // Rules for submitted applications (admin review)\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    // Rules for site-wide settings\n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n\n    // Rules for news/CMS\n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n\n    // ── 1) timeSlots ───────────────────────────────\n    match /timeSlots/{slotId} {\n      // any signed‑in user can list & view all slots\n      allow read: if request.auth.uid != null;\n\n      // only admins can create or delete slots\n      allow create, delete: if isAdmin();\n\n      // updates: either an admin, or a user _booking_ an unbooked slot\n      allow update: if\n        // admin may change anything\n        isAdmin()\n        ||\n        // booking flow: flip booked:false→true and set bookedBy==your uid\n        (\n          // original doc must be unbooked:\n          resource.data.booked == false\n          // new doc must be booked by you (no other fields changed)\n          && request.resource.data.booked == true\n          && request.resource.data.bookedBy == request.auth.uid\n          // and you can’t maliciously edit other fields:\n          && request.resource.data.time == resource.data.time\n        );\n    }\n\n    // ── 2) appointments ────────────────────────────\n    match /appointments/{apptId} {\n      // create: any signed‑in user may create their own appointment record\n      allow create: if \n        request.auth.uid != null\n        && request.resource.data.userId == request.auth.uid\n        && request.resource.data.slotId is string\n        && request.resource.data.time is timestamp\n        && request.resource.data.status == \"pending\";\n\n      // read: the booker or any admin\n      allow read: if\n        request.auth.uid == resource.data.userId\n        || isAdmin();\n\n      // updates/deletes: only admins manage status\n      allow update, delete: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:41:37.358Z] Jul 21, 2025 6:41:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:41:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:41:37.740Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:41:37.745Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:53:38.193Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:53:38.195Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    // Appointments are now request-based.\n    match /appointments/{appointmentId} {\n      // Any authenticated user can create their own appointment request.\n      allow create: if request.auth.uid != null && request.resource.data.userId == request.auth.uid;\n\n      // A user can read their own appointment. An admin can read all appointments.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n\n      // Only an admin can update (confirm/decline) or delete an appointment.\n      allow update, delete: if isAdmin();\n    }\n\n    match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n    \n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n\n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:53:38.223Z] Jul 21, 2025 6:53:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:53:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:53:38.448Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:53:38.453Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T18:59:51.174Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T18:59:51.187Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    function isAdmin() {\n      // This will be true if the user has a custom claim of `admin: true`.\n      // Ensure this is set for your admin user account.\n      return request.auth.token.admin == true;\n    }\n\n    // USER DATA: Users can manage their own data. Admins can manage any user.\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    // SUBMITTED APPLICATIONS: Users create their own. Admins manage all.\n    match /applications/{appId} {\n      allow create: if request.auth.uid == request.resource.data.userId;\n      allow read: if resource.data.userId == request.auth.uid || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    // APPOINTMENT REQUESTS:\n    match /appointments/{apptId} {\n      // Any authenticated user can create an appointment request for themselves.\n      allow create: if request.auth.uid != null && request.resource.data.userId == request.auth.uid;\n\n      // A user can read their own appointment. An admin can read all appointments.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n\n      // Only an admin can update (confirm/decline) or delete.\n      allow update, delete: if isAdmin();\n    }\n\n    // ADMIN-ONLY COLLECTIONS:\n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n    match /news/{docId} {\n      allow read, write: if isAdmin();\n    }\n     match /mail/{docId} {\n      allow create: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T18:59:51.244Z] Jul 21, 2025 6:59:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 6:59:51 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T18:59:51.580Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T18:59:51.588Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T19:06:49.216Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T19:06:49.216Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for admin custom claim\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // USER DATA\n    match /users/{userId}/{path=**} {\n      // Users can read and write their own data. Admins can read anyone's data.\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    // APPLICATIONS\n    match /applications/{appId} {\n      allow read, update: if isAdmin();\n    }\n    \n    match /users/{userId}/application/{appId} {\n        allow read, write: if request.auth.uid == userId;\n        allow read: if isAdmin();\n    }\n    \n    // APPOINTMENTS\n    match /appointments/{appointmentId} {\n      // Any authenticated user can create their own appointment request.\n      allow create: if request.auth.uid != null && request.resource.data.userId == request.auth.uid;\n\n      // A user can read their own appointment. Admins can also read any single appointment.\n      allow get: if request.auth.uid == resource.data.userId || isAdmin();\n\n      // Only admins can list all appointments. This fixes the error on the admin page.\n      allow list: if isAdmin();\n      \n      // Only admins can update (confirm/decline) or delete appointments.\n      allow update, delete: if isAdmin();\n    }\n    \n    // SETTINGS\n    match /settings/{docId} {\n      // Any authenticated user can read settings (like available times).\n      allow read: if request.auth != null;\n      // Only admins can write settings.\n      allow write: if isAdmin();\n    }\n\n    // NEWS & ANNOUNCEMENTS\n    match /news/{docId} {\n      // Anyone can read news.\n      allow read;\n      // Only admins can create/update news.\n      allow write: if isAdmin();\n    }\n\n    // DENY ALL OTHER ACCESS\n    match /{path=**} {\n      allow read, write: if false;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T19:06:49.231Z] Jul 21, 2025 7:06:49 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 7:06:49 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T19:06:49.349Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T19:06:49.350Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T19:15:25.439Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T19:15:25.440Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for admin custom claim\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // Users can read and write their own data. Admins can read/write any user's data.\n    match /users/{userId}/{documents=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    // Submitted applications can only be accessed by admins.\n    match /applications/{appId} {\n        allow read, update, delete: if isAdmin();\n    }\n\n    // Appointments can be created by the user, but only managed by admins.\n    match /appointments/{appointmentId} {\n      // Any authenticated user can create an appointment for themselves.\n      allow create: if request.auth.uid != null && request.resource.data.userId == request.auth.uid;\n      // A user can read their own appointment, and an admin can read any appointment.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n      // Only admins can update (confirm/decline) or delete appointments.\n      allow update, delete: if isAdmin();\n    }\n\n    // Settings can be read by any authenticated user (e.g., for available times)\n    // but only written to by admins.\n    match /settings/{docId} {\n      allow read: if request.auth != null;\n      allow write: if isAdmin();\n    }\n    \n    // News can be read by anyone, but only written by admins.\n    match /news/{docId} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    // Admins need to query the 'application' collection group to see all applications.\n    match /{path=**}/application/{appId} {\n      allow read: if isAdmin();\n    }\n  }\n}"}]}}
[debug] [2025-07-21T19:15:25.463Z] Jul 21, 2025 7:15:25 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 7:15:25 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T19:15:25.626Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T19:15:25.627Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T19:21:48.485Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T19:21:48.489Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for the admin custom claim on a user's token.\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // Rules for the `users` collection and all sub-collections (like application drafts).\n    // A user can read/write their own data, or an admin can.\n    match /users/{userId}/{documents=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n\n    // Rules for the top-level `applications` collection (for submitted applications).\n    // Only admins can access these documents.\n    match /applications/{applicationId} {\n      allow read, update, delete: if isAdmin();\n    }\n    \n    // Rule for the `application` collection group query used by admins.\n    // This allows admins to query across both /users/{userId}/application and /applications.\n    match /{path=**}/application/{applicationId} {\n       allow read, list: if isAdmin();\n    }\n\n    // Rules for the `appointments` collection.\n    match /appointments/{appointmentId} {\n      // A user can create an appointment request if the data is perfectly formed.\n      // This strict rule prevents bad data and ensures the client and security rules match perfectly.\n      allow create: if request.auth != null\n                    && request.resource.data.userId == request.auth.uid\n                    && request.resource.data.status == \"pending\"\n                    && request.resource.data.userName is string\n                    && request.resource.data.userEmail is string\n                    && request.resource.data.requestedDate is string\n                    && request.resource.data.requestedTime is string\n                    && request.resource.data.topic is string\n                    && request.resource.data.size() == 8; // Ensures no extra fields are added\n\n      // A user can read their own appointments, and an admin can read any appointment.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n\n      // Only admins can update (e.g., confirm/decline) or delete appointments.\n      allow update, delete: if isAdmin();\n    }\n    \n    // Rules for general app settings.\n    match /settings/{settingId} {\n      // Any authenticated user can read settings (e.g., for available appointment times if we re-add that feature).\n      allow read: if request.auth.uid != null;\n      // Only admins can write settings.\n      allow write: if isAdmin();\n    }\n\n    // Rules for news/CMS posts.\n    match /news/{newsId} {\n      // Anyone can read news posts.\n      allow read: if true;\n      // Only admins can create or edit them.\n      allow write: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T19:21:48.498Z] Jul 21, 2025 7:21:48 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 7:21:48 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T19:21:48.651Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T19:21:48.651Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T20:55:23.597Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T20:55:23.597Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    match /users/{userId}/{document=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    match /applications/{applicationId} {\n      allow read, update, delete: if isAdmin();\n    }\n    \n    match /appointments/{appointmentId} {\n      // TEMPORARY DEBUGGING RULE: Allow any logged-in user to create.\n      allow create: if request.auth.uid != null;\n      \n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    match /settings/{settingId} {\n      allow read, write: if isAdmin();\n      allow read: if request.auth.uid != null;\n    }\n\n    match /news/{newsId} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n    \n    match /{path=**}/application/{applicationId} {\n       allow read, list: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T20:55:23.622Z] Jul 21, 2025 8:55:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 8:55:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T20:55:23.666Z] Jul 21, 2025 8:55:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 8:55:23 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-21T20:55:23.840Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T20:55:23.841Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-21T20:58:00.632Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-21T20:58:00.633Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for admin custom claim\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // Rules for users collection and their sub-collections (like application drafts)\n    match /users/{userId}/{document=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    // Rules for submitted applications\n    match /applications/{applicationId} {\n      allow read, update, delete: if isAdmin();\n      // Users should not be able to create new top-level applications directly\n      allow create: if false; \n    }\n    \n    // Rules for appointments\n    match /appointments/{appointmentId} {\n      // TEMPORARY DEBUGGING RULE: Allow any logged-in user to create an appointment.\n      allow create: if request.auth.uid != null;\n\n      // A user can read their own appointment, admins can read any.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n      \n      // Only admins can change an appointment's status or delete it.\n      allow update, delete: if isAdmin();\n    }\n    \n    // Rules for general app settings\n    match /settings/{settingId} {\n      allow read, write: if isAdmin();\n    }\n\n    // Rules for news/CMS posts\n    match /news/{newsId} {\n      // Anyone can read news\n      allow read: if true;\n      // Only admins can create/edit news\n      allow write: if isAdmin();\n    }\n    \n    // Rule for the 'application' collection group query used by admins\n    match /{path=**}/application/{applicationId} {\n       allow read, list: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-21T20:58:00.651Z] Jul 21, 2025 8:58:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 21, 2025 8:58:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-21T20:58:00.780Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-21T20:58:00.781Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-23T18:05:27.741Z] ----------------------------------------------------------------------
[debug] [2025-07-23T18:05:27.750Z] Command:       /nix/store/ws50yvm6vzlzf7jzz6n7xh4szddrack1-nodejs-20.19.1/bin/node /nix/store/gv0i9ndcpzjpfi2yr06402kzy90q51ki-firebase-tools-14.10.1/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-23T18:05:27.752Z] CLI Version:   14.10.1
[debug] [2025-07-23T18:05:27.752Z] Platform:      linux
[debug] [2025-07-23T18:05:27.753Z] Node Version:  v20.19.1
[debug] [2025-07-23T18:05:27.753Z] Time:          Wed Jul 23 2025 18:05:27 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-23T18:05:27.753Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-23T18:05:27.758Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-07-23T18:05:29.155Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-07-23T18:05:29.156Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-07-23T18:05:29.582Z] openjdk version "21.0.7" 2025-04-15
OpenJDK Runtime Environment (build 21.0.7+6-nixos)
OpenJDK 64-Bit Server VM (build 21.0.7+6-nixos, mixed mode, sharing)

[debug] [2025-07-23T18:05:29.614Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-23T18:05:29.638Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-23T18:05:29.647Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-23T18:05:29.675Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-23T18:05:29.677Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-23T18:05:29.677Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/6630rdigdc1h6ay3q6zs9bnvj2zrs70g-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-23T18:05:34.304Z] Jul 23, 2025 6:05:34 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 23, 2025 6:05:34 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-23T18:05:34.364Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-23T18:05:34.368Z] 127.0.0.1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080"}}
[debug] [2025-07-23T18:05:34.370Z] 
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-23T18:05:34.487Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-23T18:08:30.187Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-23T18:08:30.188Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper function for admin custom claim check\n    function isAdmin() {\n      return request.auth.token.admin == true;\n    }\n\n    // Rules for the 'users' collection and all sub-collections (like application drafts)\n    match /users/{userId}/{path=**} {\n      allow read, write: if request.auth.uid == userId || isAdmin();\n    }\n    \n    // Rules for the top-level 'applications' collection (submitted applications)\n    match /applications/{applicationId} {\n      // Only admins can read, update, or delete submitted applications\n      allow read, update, delete: if isAdmin();\n      // No one can create documents here directly; they are created server-side or via a secure function\n      allow create: if false; \n    }\n    \n    // Rules for the 'appointments' collection\n    match /appointments/{appointmentId} {\n      // Allow a user to create an appointment if the document has the correct structure and ownership\n      allow create: if request.auth.uid != null\n        && request.resource.data.userId == request.auth.uid\n        && request.resource.data.size() == 8\n        && request.resource.data.userName is string\n        && request.resource.data.userEmail is string\n        && request.resource.data.requestedDate is string\n        && request.resource.data.requestedTime is string\n        && request.resource.data.topic is string\n        && request.resource.data.status == \"pending\"\n        && request.resource.data.createdAt is timestamp;\n\n      // Allow a user to read their own appointments, and admins to read all appointments.\n      allow read: if request.auth.uid == resource.data.userId || isAdmin();\n\n      // Only allow admins to update (e.g., change status) or delete appointments.\n      allow update, delete: if isAdmin();\n    }\n    \n    // Rules for 'settings' collection (e.g., site-wide configurations)\n    match /settings/{docId} {\n      allow read, write: if isAdmin();\n    }\n    \n    // Rules for 'news' collection (CMS content)\n    match /news/{docId} {\n      // Anyone can read news posts\n      allow read: if true;\n      // Only admins can create/update/delete news posts\n      allow write: if isAdmin();\n    }\n\n    // Rule for the 'application' collection group query used by admins\n    // This allows admins to query across all users' 'application' sub-collections\n    match /{path=**}/application/{applicationId} {\n       allow read, list: if isAdmin();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-23T18:08:30.229Z] Jul 23, 2025 6:08:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 23, 2025 6:08:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-23T18:08:30.936Z] Jul 23, 2025 6:08:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 23, 2025 6:08:30 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-23T18:08:34.482Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-23T18:08:34.485Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
